name: Go CI/CD

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup Go
      uses: actions/setup-go@v5
      with:
        go-version: "1.22"
        check-latest: true
        cache: true

    - name: Install dependencies
      run: go mod download

    - name: Run tests
      run: go test ./... -v || echo "âš ï¸  No tests found"

    - name: Build App
      run: go build -o ums-backend main.go

    - name: Verify Build
      run: |
        if [ -f "ums-backend" ]; then
          echo "âœ… Build successful!"
          ls -lh ums-backend
        else
          echo "âŒ Build failed - binary not found"
          exit 1
        fi

    - name: Deployment Info
      if: github.ref == 'refs/heads/main' && github.event_name == 'push'
      run: |
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo "âœ… Build passed successfully!"
        echo "ğŸš€ Render will auto-deploy this commit automatically"
        echo ""
        echo "ğŸ“ To enable manual deployment trigger:"
        echo "   1. Go to: GitHub Settings â†’ Secrets â†’ Actions"
        echo "   2. Add secret: RENDER_DEPLOY_HOOK"
        echo "   3. Value: https://api.render.com/deploy/srv-d4jfdskhg0os73bos68g?key=8g9edUNfAMA"
        echo ""
        echo "ğŸ” Check deployment status:"
        echo "   â†’ https://dashboard.render.com/"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
